# cleans up the old build images
sudo nix-collect-garbage --delete-older-than 15d

# nixos rebuild does not update any packages
# upstream unstable and stable 23.11
# a nixos config file with packages may or may not run on someone else's computer depending on what channel you are on.

# this is where nix flakes comes in to solve the problem. they are basically a system to manage co dependencies in a declarative way.
# you create a flake.nix file to declare your branch and keep track of your nixpkgs dependencies.
# then flakes system automatically creates a lock file
# nix flake update can then be used to update all flake dependencies
# our flake config wont be dependeble on a special system channel.

# to enable nix flakes add this line to your nixos config:
nix.settings.experimental-features = [ "nix-command" "flakes" ];

# change directory to /etc/nixos and run:
sudo nix flake init --template github:vimjoyer/flake-starter-config

# rebuild with flake
sudo nixos-rebuild switch --flake /etc/nixos#default

# ls and you can see your flake.lock file

# modules are chunks of nixos code that enable functions and features

nix run home-manager/master -- init && \
sudo cp ~/.config/home-manager/home.nix /etc/nixos/

sudo nixos-rebuilt switch --flake /etc/nixos#default

